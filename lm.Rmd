---
title: "Comparison on fuel economy for cars with manual vs automatic transmission"
author: "Alex"
date: "Thursday, October 15, 2015"
output: html_document
       
---

## Summary

While intuitively it looks like manual transmission provides better fuel
economy, statistical analysis of specifications for 32 cars of 1973-74 year
models does not allow to do such conclusion. A better explanation for
difference in miles per gallon is the difference in car weights.
From the data presented, there's more than 5% chance that cars with manual
transmissions may just look more efficient while in fact manual transmissions
are just more likely
to be used on lighter models, and their higher mpg rating is just
an consequence.

```{r, include=FALSE}
# Load data and libraries
library(plyr)
library(dplyr)
library(ggplot2)
library(datasets)
data(mtcars)
library(GGally)
m    <- mtcars
m$am <- revalue(as.factor(mtcars$am), replace=c("0"="Automatic","1"="Manual"))
m4   <- m[m$cyl == 4,]
m6   <- m[m$cyl == 6,]
m8   <- m[m$cyl == 8,]
```

## Single-variable analysis

Direct comparison of fuel economy for cars with manual and automatic
transmission shows visible difference.

```{r}
plot(x=m$am,y=m$mpg)
(fitS<-lm(mpg~am,m))
```

Linear model for MPG dependancy on transmission type seems to show that
upgrading transmission to automatic will lose 7 miles less driven per gallon
of fuel.

But because this wasn't a randomized test, there's a chance that this
difference isn't actually real, and there was a confounding variable that
makes manufactures install automatic transmission in car that would have worse
MPGs anyway.

First, it can be shown that the scale of this difference is smaller for cars
where engines have more cylinders.

```{r}
m %>% group_by(am, cyl) %>% dplyr::summarize(mean=mean(mpg)) -> mm
mm$cyl<-as.factor(mm$cyl)
print(ggplot(data = mm, aes(x = cyl, y=mean, fill=am)) +
              geom_bar(stat="identity", position="dodge") +
              ylab(label = "Mean mpg") +
              scale_x_discrete("Cylinders", breaks=c("4","6","8")) +
              guides(fill=guide_legend(title="Transmission"))
      )
```

It can't be even said with 95% confidence that for cars with 8-cylinder engines
the difference is even statistically significant.

```{r}
t.test(m8[m8$am == "Automatic", "mpg"],
       m8[m8$am == "Manual","mpg"],
       var.equal = FALSE,
       paired = FALSE)$conf
```

Does this mean that the difference becomes insignificant
compared to the total wastefulness of a powerful engine? Let's include other
parameters in analysis.

## Multi-variable analysis

A linear model that includes all variables attributes only difference of
2 miles per gallon to transmission type.

```{r}
(fitM<-lm(mpg~.,m))
```

This model has too many parameters to provide us with clear answers when
there are just 32 observations - we have too freedom in explaining variability
in the dataset. Many of variables are obviously correlated - heavier cars
need bigger engines with higher displacement volume that achieved by more
cylinders, and than this engines will consume more fuel, but will go faster,
given equal weight.

By looking
correlation coeffificents between different parameters of the cars
(see Appendix), we see that weight has the highest correlation with MPG.

The model where we only consider weight and transmission type, shows that
transmission infuence on MPG is very small, and not significant.

```{r}
(fit2<-lm(mpg~wt+am,m))
confint(fit2)
```

## Appendices

### Appendix 1. Code book for the dataset

A data frame with 32 observations on 11 variables.

[, 1]         mpg	 Miles/(US) gallon  
[, 2]	 cyl	 Number of cylinders  
[, 3]	 disp	 Displacement (cu.in.)  
[, 4]	 hp	 Gross horsepower  
[, 5]	 drat	 Rear axle ratio  
[, 6]	 wt	 Weight (lb/1000)  
[, 7]	 qsec	 1/4 mile time  
[, 8]	 vs	 V/S  
[, 9]	 am	 Transmission (0 = automatic, 1 = manual)  
[,10]	 gear	 Number of forward gears  
[,11]	 carb	 Number of carburetors

### Appendix 2. Multi-variable correlation

```{r, cache=TRUE}
print(ggpairs(mtcars, lower = list(continuous = "smooth"),params = c(method = "loess")))
```

We see that mpg correlates mostly to cars' power - expresses ad engine volume
and number of cylinders - and weight, and less to transmission type.

### Appendix 3. Weights of cars

Just to be sure, let's check if average weight indeed different for cars with
automatic and manual transmissions.

```{r}
plot(m$am,m$wt)
```

We can also see that
the difference is weights is higher for 4-cylinder models, so that explains
why MPG difference for automatic and manual transmissions was higher for
4-cylinder models.

```{r}
plot(m4$am, m4$wt, main = "Weights of cars with 4-cylinder engines")
plot(m8$am, m8$wt, main = "Weights of cars with 8-cylinder engines")
```
